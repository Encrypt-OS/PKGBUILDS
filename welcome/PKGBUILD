# Maintainer: Encrypt-OS <info@Encrypt-OS.com>

pkgname=welcome
pkgdesc="Welcome greeter for new Encrypt-OS users."
pkgver=3.17.31
pkgrel=2
arch=('any')
license=('GPL')
depends=(
    systemd eos-bash-shared eos-translations
    eos-quickstart
)
optdepends=(
  'translate-shell: for generating a language translation for the User Interface'
  'reflector-simple: for the Update Mirrors button'
  'yad: upstream yad provider'
  'yad-eos: alternative yad provider (includes fixes)'
  'kdiff3: alternative app for pacdiff to use'
  'meld: alternative app for pacdiff to use'
  'diffuse: alternative app for pacdiff to use'
  'vim: alternative app for pacdiff to use'
)

url=https://github.com/Encrypt-OS/PKGBUILDS/tree/master/$pkgname
_url="https://raw.githubusercontent.com/Encrypt-OS/PKGBUILDS/master/$pkgname"

source=(
  $_url/$pkgname
  $_url/$pkgname.desktop
  $_url/wallpaper-once
  $_url/wallpaper-once.desktop
  $_url/eos-kill-yad-zombies
  $_url/welcome-dnd
  $_url/eos-install-mode-run-calamares
)
sha512sums=('1f4460a646f3f0c12fbff0a65a4e8cd2d2de7be5af7e9f5e0e722437d875e5bb0025c3eacc6b559e7799903f99c48fa94e2f7b83a9bca700704642bda08e34ed'
            '8bb1052a8f104e2a0c4be95d6fbf8e38f4bfa6a548ef992bcf9a6be480aa85f0d14cc38fc44c756e5455b6da688ea04ca87f110673517a3117e283eb86e1f63a'
            'a93e14e5c53ecbd64dacd5585e05816acc34870043464dddd94145cb17c42bac67f1f22eb389dbf9a57ef1b104cea84e5a81507db9af915b27966de8d5176633'
            '65dba1a339a5e9b4c92d0614830922ca7b0d419d6e029084a15207a3383cd12c6803035a97d661f799aecc53cb34e0f94a593293f011ebc1b95beefe5ed42dd4'
            '90dfc1f08a428787305d72a2e439a377aee0bc095fcb0a2efb4245a15285d4b96b5e0ac644c02f27ab68aebbfc5c64e6ab7d733d9db8952d2999d589410d3b9e'
            '949433a6d4994008d29cd0b481997443eb4260b6d77c9fd990fc3b5f67ad1d635b86ead8c275090f4e786f0555741981d001085b0db5221506b038681db89630'
            'd7581ca1fb46b8b605a2eb2af27b126f1006c92e8c651238e911d596f20cb7e446795fade5f0974d26d0197eb57009391013be9b64d0ba8cffae8111f7aeb9b6')
package() {
  install -d $pkgdir/usr/share/Encrypt-OS/scripts
  install -Dm755 $pkgname                 $pkgdir/usr/share/Encrypt-OS/scripts/$pkgname
  install -Dm755 wallpaper-once           $pkgdir/usr/share/Encrypt-OS/scripts/wallpaper-once

  install -d $pkgdir/usr/bin
  ln -s /usr/share/Encrypt-OS/scripts/$pkgname $pkgdir/usr/bin/eos-$pkgname

  install -Dm755 eos-kill-yad-zombies           $pkgdir/usr/bin/eos-kill-yad-zombies
  install -Dm755 welcome-dnd                    $pkgdir/usr/bin/welcome-dnd
  install -Dm755 eos-install-mode-run-calamares $pkgdir/usr/bin/eos-install-mode-run-calamares

  install -d $pkgdir/etc/xdg/autostart
  install -Dm644 wallpaper-once.desktop   $pkgdir/etc/xdg/autostart/wallpaper-once.desktop
  install -Dm644 $pkgname.desktop         $pkgdir/etc/xdg/autostart/$pkgname.desktop      # no --once

  install -d $pkgdir/usr/share/applications
  cp -a $pkgname.desktop $pkgname.desktop-enable
  sed -i $pkgname.desktop-enable \
      -e 's|^\(Exec=.* --startdelay.*\)$|#\1|' \
      -e 's|^#\(Exec=.* --once.*\)$|\1|'
  install -Dm644 $pkgname.desktop-enable         $pkgdir/usr/share/applications/$pkgname.desktop      # has --once
}
